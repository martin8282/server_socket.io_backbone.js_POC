/**
 * filtr - MongoDB inspired array filtering
 * Copyright(c) 2012 Jake Luer <jake@alogicalparadox.com>
 * @see https://github.com/logicalparadox/filtr
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("filtr",function(){function c(a,b){if(a&&b)for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return a}function d(a){if(global==this)return new d(a);this.query=a,this.stack=g(a)}function e(a){var b=a.split(".").filter(Boolean);return b.map(function(a){var b=/([A-Za-z0-9]+)\[(\d+)\]$/,c=b.exec(a),d;return c&&(d={p:c[1],i:c[2]}),d||a})}function f(a,b){var c=b,d;for(var e=0,f=a.length;e<f;e++){var g=a[e];c?("object"==typeof g&&c[g.p]?c=c[g.p][g.i]:c=c[g],e==f-1&&(d=c)):d=undefined}return d}function g(a){var b=[];for(var c in a){var d={},f=a[c];c[0]=="$"?d.test=h(a):"string"==typeof f||"number"==typeof f||"boolean"==typeof f?(d.test=h({$eq:f}),d.path=e(c)):(d.test=h(f),d.path=e(c)),b.push(d)}return b}function h(a){var c=[];for(var e in a){var f=d.comparators[e],g=a[e],i=!1;if(b[e]){var j=[];for(var k=0;k<g.length;k++)j.push(h(g[k]));i=!0}c.push({fn:f,params:i?j:g,traverse:i})}return c}function i(a,b){var c=!0;for(var d=0;d<b.length;d++){var e=b[d],f=e.params;if(e.traverse){var g=[];for(var h=0;h<f.length;h++){var j=f[h];g.push(i(a,j))}f=g}e.fn.length==1?e.fn(f)||(c=!1):e.fn(a,f)||(c=!1)}return c}if(!a)var a={};var b={$and:!0,$or:!0,$nor:!0};return a.exports=d,d.version="0.1.3",d.comparators={$gt:function(a,b){return a>b},$gte:function(a,b){return a>=b},$lt:function(a,b){return a<b},$lte:function(a,b){return a<=b},$all:function(a,b){for(var c=0;c<b.length;c++)if(!~a.indexOf(b[c]))return!1;return!0},$exists:function(a,b){return!!a==b},$mod:function(a,b){return a%b[0]==b[1]},$eq:function(a,b){return a==b},$ne:function(a,b){return a!=b},$in:function(a,b){return~b.indexOf(a)?!0:!1},$nin:function(a,b){return~b.indexOf(a)?!1:!0},$size:function(a,b){return a.length&&b?a.length==b:!1},$or:function(a){var b=!1;for(var c=0;c<a.length;c++){var d=a[c];d&&(b=!0)}return b},$nor:function(a){var b=!0;for(var c=0;c<a.length;c++){var d=a[c];d&&(b=!1)}return b},$and:function(a){var b=!0;for(var c=0;c<a.length;c++){var d=a[c];d||(b=!1)}return b}},d.getPathValue=function(a,b){var c=e(a);return f(c,b)},d.prototype.test=function(a,b){var d={type:"set",spec:"subset"},e=c(b||{},d),g=e.type=="single"?!1:[],h,j;e.type=="single"&&(a=[a]);for(var k=0,l=a.length;k<l;k++){var m=a[k],n=!0;for(var o=0,p=this.stack.length;o<p;o++)h=this.stack[o],j=h.path?f(h.path,m):m,i(j,h.test)||(n=!1);if(e.type=="single")g=n;else switch(e.spec){case"boolean":g.push(n);break;case"index":n&&g.push(k);break;default:n&&g.push(m)}}return g},a.exports})